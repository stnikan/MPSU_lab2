/*
 * test2.c
 *
 * Created: 14.09.2023 10:18:10
 * Author : stnik
 */ 

#include <avr/io.h>
#define F_CPU 11059200UL
#include <util/delay.h>
#include <avr/interrupt.h>   //äëÿ èñïîëüçîâàíèÿ ïðåðûâàíèé

//———————————————

uint16_t sec = 0;
uint8_t my_str_a[]    = { 0xE0, 0xF8,0xFC,0xFE, 0xFE, 0xFF, 0xCF, 0xCF, 0x07, 0x1F, 0x3F, 0x7F, 0x63, 0xC1, 0x81, 0x81}; //E0
uint8_t my_str_c[]    = { 0xFF, 0xFF,0x7F,0x3F, 0x02, 0x04, 0x18, 0xE0, 0x99, 0x98, 0x80, 0x40, 0x40, 0x20, 0x18, 0x07};
uint8_t my_lyg_a[]    = { 
	0b11101110, 0b00010001, 0b01010101, 0b01010101, 0b01010001, 0b01001110, 0b01000010, 0b01000010,
	0b01101100, 0b01010011, 0b01000111, 0b11000001, 0b10111001, 0b10000001, 0b01111001, 0b00100001}; 
uint8_t my_lyg_c[]    = {
	0b01000010, 0b01000010, 0b01001110, 0b01010001, 0b01010101, 0b01010101, 0b00010001, 0b11101110,
	0b00100001, 0b01111001, 0b10000001, 0b10111001, 0b11000001, 0b01000111, 0b01010011, 0b01101100};	
	
uint8_t my_pok_a[]    = {	
	0b00000000, 0b10111110, 0b00001010, 0b10001110, 0b00000000, 0b10011110, 0b01010010, 0b00011110,
	0b00000000,  0b00000111, 0b00000100, 0b00000111, 0b00000000, 0b000000111, 0b00000101, 0b00110111};
uint8_t my_pok_c[]    = {	
	0b00000000, 0b10011110, 0b11000100, 0b10001010, 0b00010000, 0b11000000, 0b00000000, 0b00000000,
	0b01100000, 0b00110111, 0b00000010, 0b00000111, 0b00000000, 0b00000111, 0b00000000, 0b00000000};
	
uint8_t my_column[] ={
	0x00,0x10,0x20,0x30,0x40,0x50,0x60,0x70,
	0x80,0x90,0xA0,0xB0,0xC0,0xD0,0xE0,0xF0};
	
uint8_t i = 0;

//———————————————

void timer_ini(void)
{	
	//òàéìåð äëÿ ñìåíû êàðòèíêè...
	TIMSK = (1<<TOIE1); //ðàçðåøåíèå èñïîëüçîâàíèÿ ñ÷åò÷èêà äëÿ ïðåðûâàíèé
	TCCR1B = (1<<CS12); //èñïîëüçóåì äåëèòåëü ÷àñòîòû
	TCNT1 = 65500; //initial value for timer to start counting
	
	//íàì áîëüøå íå íóæåí äåëåé
	TCCR3B = (1<<CS32); //èñïîëüçóåì äåëèòåëü ÷àñòîòû
	ETIMSK |= (1<<TOIE3);
	//TCNT3 = 65300;
	TCNT3 = 22058; 
}

//———————————————

ISR (TIMER1_OVF_vect) //ñìåíà ðèñóåìîãî ñòîëáöàè è âûâîä êàðòèíêè
{
	TCNT1 = 65520; 
	i = (i+1)%16;
	PORTD = my_column[i];
	PORTA =  my_lyg_a[i];
	PORTC =my_pok_c[i];; //my_str[(i+4)%8];;
}
//———————————————
ISR (TIMER3_OVF_vect) //ñìåíà êàðòèíêè
{
	TCNT3 = 22058;// 65300;
	//i = (i+1)%8;
	//PORTD = my_column[i];
	//PORTA = my_str[i];
	if(sec>=5){
		sec=0;
		
		for (uint8_t i = 0; i<16;i++){
			
			my_str_a[i] = ~my_str_a[i];
			my_str_c[i] = ~my_str_c[i];
		}
	}
	else {sec++;}
	
}






int main(void)
{	
	
    DDRA = 0xFF; 
    DDRD = 0xFF;
	DDRC = 0xFF;
	

	timer_ini();
	sei();
	 //ðàçðåøåíèå ïðåðûâàíèé
	

	
    while (1) 
    {	
			
		
    }
}
